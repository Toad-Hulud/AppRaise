# Приложение для управления организационной структурой

Тестовое задание для AppRaise. Проект построен с использованием монорепозитория Nx с Next.js для фронтенда и NestJS для бэкенда. Фронтенд-приложение отображает организационную диаграмму, и пользователи могут выполнять операции CRUD над участниками организации.

## Техстек

- **Фронтенд**: Next.js, React, Material-UI, Redux
- **Бэкенд**: NestJS, TypeORM, PostgreSQL
- **Инструменты**: Nx, Docker, Docker Compose

## Функции

- Отображение организационной структуры
- Добавление, удаление и изменение менеджера пользователtq
- Обновление списка пользователей

## Требования

- Node.js v18.x.x
- Docker
- Docker Compose

## Установка

1. Клонируйте репозиторий:

   ```sh
   git clone https://your-repository-url.git
   cd your-repository
   ```

2. Установите зависимости:

   ```sh
   npm install
   ```

3. Создайте файл конфигурации для бэкенда:

   ```sh
   cp packages/api/.env.example packages/api/.env
   ```

4. Создайте файл конфигурации для фронтенда:

   ```sh
   cp packages/client/.env.example packages/client/.env.local
   ```

## Переменные окружения

Убедитесь, что у вас настроены следующие переменные окружения:

Для API:

### Создайте файл в packages/api/.env

(можете взять из .env.example)

- `DB_TYPE` - тип базы данных (например, `postgres`)
- `DB_HOST` - хост базы данных
- `DB_USER` - пользователь базы данных
- `DB_PASSWORD` - пароль пользователя базы данных
- `DB_NAME` - имя базы данных
- `DB_PORT` - порт базы данных

Для фронтенда:

### Создайте файл в packages/client/.env.local

(можете взять из .env.example)

- `NEXT_PUBLIC_API_URL` - URL API (например, `http://api:3000`)

## Запуск приложения

1. Запустите бэкенд-приложение:

   ```sh
   npx nx run api:dev
   ```

1.1 Но лучше через докер`)`

2. Запустите фронтенд-приложение:

   ```sh
   npx nx run client:dev
   ```

## Настройка Docker

1. Создайте и запустите контейнеры Docker:

   ```sh
   docker-compose up --build
   ```

2. API будет доступно по адресу [http://localhost:3000](http://localhost:3000). (Клиент тоже работает, можете раскоментить в docker-compose.yml но он дает ошибку на первый рендер странциы, но все проходит после нажатия кнопки Refresh Users)

## Структура проекта

- `apps/client` - фронтенд-приложение на Next.js
- `apps/api` - бэкенд-приложение на NestJS
- `Dockerfile.backend` - Dockerfile для бэкенда
- `Dockerfile.frontend` - Dockerfile для фронтенда
- `docker-compose.yml` - настройки Docker Compose

## Использование

### Функционал кнопок

- **Add User**: Открывает модальное окно для добавления нового пользователя. Введите имя пользователя и нажмите "Add User".
- **Delete All Users**: Удаляет всех пользователей из базы данных.
- **Refresh Users**: Обновляет список пользователей, загружая их заново с сервера.
- **Cancel Manager Assignment**: Появляется в режиме выбора менеджера, отменяет текущий выбор менеджера.

### Смена менеджера

1. Нажмите на кнопку с тремя точками рядом с пользователем и выберите "Change Manager".
2. Включится режим выбора менеджера.
3. Выберите нового менеджера, щелкнув по нужному пользователю. Важно: вы не можете выбрать пользователя, который является подчиненным выбранного.
4. Менеджер выбранного пользователя обновится.
5. Если выбранный менеджер уже является менеджером, у него вместо контекстного меню появится кнопка с красным крестиком для удаления текущего менеджера.
